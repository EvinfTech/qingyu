(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/reservationDetail/reservationDetail"],{201:function(t,e,i){"use strict";(function(t,e){var n=i(4);i(26);n(i(25));var r=n(i(202));t.__webpack_require_UNI_MP_PLUGIN__=i,e(r.default)}).call(this,i(1)["default"],i(2)["createPage"])},202:function(t,e,i){"use strict";i.r(e);var n=i(203),r=i(205);for(var s in r)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return r[t]}))}(s);i(207);var a,o=i(32),c=Object(o["default"])(r["default"],n["render"],n["staticRenderFns"],!1,null,"096d5afc",null,!1,n["components"],a);c.options.__file="pages/reservationDetail/reservationDetail.vue",e["default"]=c.exports},203:function(t,e,i){"use strict";i.r(e);var n=i(204);i.d(e,"render",(function(){return n["render"]})),i.d(e,"staticRenderFns",(function(){return n["staticRenderFns"]})),i.d(e,"recyclableRender",(function(){return n["recyclableRender"]})),i.d(e,"components",(function(){return n["components"]}))},204:function(t,e,i){"use strict";var n;i.r(e),i.d(e,"render",(function(){return r})),i.d(e,"staticRenderFns",(function(){return a})),i.d(e,"recyclableRender",(function(){return s})),i.d(e,"components",(function(){return n}));try{n={uNavbar:function(){return Promise.all([i.e("common/vendor"),i.e("node-modules/uview-ui/components/u-navbar/u-navbar")]).then(i.bind(null,357))},uIcon:function(){return Promise.all([i.e("common/vendor"),i.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(i.bind(null,330))}}}catch(o){if(-1===o.message.indexOf("Cannot find module")||-1===o.message.indexOf(".vue"))throw o;console.error(o.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var t=this,e=t.$createElement,i=(t._self._c,t.choosedList.length);t.$mp.data=Object.assign({},{$root:{g0:i}})},s=!1,a=[];r._withStripped=!0},205:function(t,e,i){"use strict";i.r(e);var n=i(206),r=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=r.a},206:function(t,e,i){"use strict";(function(t){var n=i(4);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(i(56)),s=n(i(58)),a=i(171),o=i(170);function c(t,e){var i="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=u(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){o=!0,s=t},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw s}}}}function u(t,e){if(t){if("string"===typeof t)return d(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var f={data:function(){return{app:null,active:0,dateList:[],translateDistance:0,tabWidth:0,widthDiff:0,scrollLeft:0,totalPrice:0,choosedList:[],centerHeight:0,timeList:[],siteList:[],todayDeleteIndex:0,con:{already:!1,checked:!1,price:""},j:"",currentDate:"",scrollLeftDistance:0}},onLoad:function(t){this.app=getApp();var e=t.date.slice(5);this.currentDate=e},onReady:function(){var t=this;this.setAciveDate(this.currentDate),this.$nextTick((function(){setTimeout((function(){t.getTabItemWidth()}),500)}))},methods:{toBack:function(){this.app.toBack()},getNowTime:function(){var t=new Date,e=t.getHours(),i=t.getMinutes();return[e,i]},initEnumInfo:function(){var t=this.app.globalData.enumInfo,e=[],i=[],n=this.dateList[this.active].siteList;n.forEach((function(t){e=e.concat(t.store_time_enum)})),e=Array.from(new Set(e)),e.sort((function(t,e){return t-e})),e.forEach((function(e){var n=t[e].split("~")[0],r=t[e].split("~")[1],s=i.findIndex((function(t){return t.value==n})),a=i.findIndex((function(t){return t.value==r}));s<0&&i.push({index:e,value:n}),a<0&&i.push({index:e,value:r})}));var r=0;if(0==this.active){var s=this.getNowTime();r=i.findIndex((function(t){var e=t.value.split(":");if(Number(e[0])>s[0]||Number(e[0])==s[0]&&Number(e[1])>s[1])return!0})),i=-1==r?[]:i.slice(r)}this.timeList=i},deleteItem:function(t){this.siteList[this.choosedList[t].siteIndex].timeList[this.choosedList[t].siteTimeIndex].checked=!1,this.totalPrice=this.totalPrice-this.choosedList[t].price/100,this.choosedList.splice(t,1)},initData:function(t){var e=this,i=[];0==this.dateList[this.active].isRequest?(0,o.request)({url:"wx/get/site/reserve",method:"POST",data:{date:t}}).then((function(t){var n=t.data;n.forEach((function(t,e){i.push({siteNo:e+1,siteId:t.site_id,disableList:t.reserve_time_enum,siteName:t.site_name,store_time_enum:t.store_time_enum,priceList:t.price,timeList:[]})})),e.dateList[e.active].siteList=i,e.dateList[e.active].isRequest=!0,e.siteList=i,e.initEnumInfo(),e.setTimeList()})):(i=this.dateList[this.active].siteList,this.siteList=i,this.initEnumInfo(),this.setTimeList())},setAciveDate:function(t){this.dateList=this.et7Days();var e=this.dateList.findIndex((function(e){return e.date==t}));this.active=e},submitOrder:function(){var e=this;return(0,s.default)(r.default.mark((function i(){var n,s,o,u,d,f,l,h,m,v;return r.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(0!=e.choosedList.length){i.next=3;break}return t.showToast({title:"未选择场地",icon:"none",duration:2e3}),i.abrupt("return");case 3:return i.next=5,e.app.getUserInfo();case 5:for(u in n=i.sent,s=[],o=(0,a.groupBy)(e.choosedList,"siteId"),o){d=[],f=0,l="",h=c(o[u]);try{for(h.s();!(m=h.n()).done;)v=m.value,d.push(Number(v.enumInfoIndex)),f+=v.price,l=v.siteName}catch(r){h.e(r)}finally{h.f()}s.push({site_id:Number(u),time_enum:d,money:f,site_name:l})}t.setStorageSync("orderInfo",JSON.stringify({user_ouid:n.ouid,site_detail:s,gmt_site_use:e.choosedList[0].date,site_obj:o,totalPrice:e.totalPrice})),t.navigateTo({url:"/pages/confirmAppointment/confirmAppointment",events:{updateSiteInfo:function(t){t.forEach((function(t){var i=e.siteList.findIndex((function(e){return e.siteId==t.site_id}));t.time_enum.forEach((function(n){var r=e.timeList.findIndex((function(t){return t.index==n}));r=0==r?0:r-1;var s=e.choosedList.findIndex((function(e){return e.siteId==t.site_id&&e.enumInfoIndex==n}));e.siteList[i].timeList[r].already=!0,e.totalPrice=e.totalPrice-e.choosedList[s].price/100,e.siteList[i].timeList[r].price="不可订",e.choosedList.splice(s,1)}))}))}}});case 11:case"end":return i.stop()}}),i)})))()},setTimeList:function(){var t=this,e=JSON.parse(JSON.stringify(this.siteList));e.forEach((function(e,i){for(var n=1;n<=t.timeList.length-1;n++){var r=e.priceList.findIndex((function(e){return e.time_enum==t.timeList[n].index}));r>=0?e.disableList.includes(t.timeList[n].index)?e.timeList.push({price:e.priceList[r].price,already:!0,checked:!0}):e.timeList.push({price:e.priceList[r].price,already:!1,checked:!1}):e.timeList.push({price:"不可订",already:!0,checked:!1})}})),this.siteList=e},getTabItemWidth:function(){var e=this,i=this,n=t.getSystemInfoSync(),r=n.windowHeight,s=t.createSelectorQuery();s.select(".customerTabItem").boundingClientRect((function(s){var a=t.createSelectorQuery();a.select(".selected").boundingClientRect((function(a){i.tabWidth=s.width,i.translateDistance=(s.width-a.width)/2,i.widthDiff=(s.width-a.width)/2,i.scrollLeft=s.width*(e.active-4),i.chooseTab(i.active);var o=t.createSelectorQuery();o.select(".bottomCon").boundingClientRect((function(e){var a=t.createSelectorQuery();a.select(".nav-bar").boundingClientRect((function(t){i.centerHeight=r-44-e.height-s.height-n.statusBarHeight})).exec()})).exec()})).exec()})).exec()},chooseTab:function(t){var e;e=t.hasOwnProperty("currentTarget")?t.currentTarget.dataset.index:t;var i=e*this.tabWidth+this.widthDiff;this.active!=e&&(this.choosedList=[],this.totalPrice=0),this.active=e,this.translateDistance=i,this.initData(this.dateList[e].fullDate)},chooseSite:function(t){var e=this,i=t.currentTarget.dataset;if(!i.item.already&&"不可订"!=i.item.price){if(this.siteList[i.index].timeList[i.j].checked=!this.siteList[i.index].timeList[i.j].checked,this.siteList[i.index].timeList[i.j].checked){var n=this.siteList[i.index],r={siteName:n.siteName,siteId:n.siteId,price:i.item.price,date:this.dateList[this.active].fullDate,startTime:this.timeList[i.j].value,endTime:this.timeList[i.j+1].value,enumInfoIndex:-1,siteIndex:i.index,siteTimeIndex:i.j},s=this.app.globalData.enumInfo;for(var a in s)if(s[a]==r.startTime+"~"+r.endTime){r.enumInfoIndex=a;break}var o=this.choosedList;o.push(r),this.choosedList=o,this.totalPrice=this.totalPrice+r.price/100}else{var c=this.choosedList.findIndex((function(t){return t.startTime==e.timeList[i.j].value})),u=this.choosedList;u.splice(c,1),this.choosedList=u,this.totalPrice=this.totalPrice-i.item.price/100}this.$nextTick((function(){e.scrollLeftDistance=9999+e.scrollLeftDistance}))}},et7Days:function(){for(var t=[],e=new Date,i=e.getTime(),n=864e5,r=0;r<7;r++){var s=i+r*n,o=new Date(s),c=o.getFullYear(),u=o.getMonth()+1,d=o.getDate();t.push({fullDate:c+"-"+(0,a.formatNumber)(u)+"-"+(0,a.formatNumber)(d),date:(0,a.formatNumber)(u)+"-"+(0,a.formatNumber)(d),day:0==r?"今日":"周"+"日一二三四五六".charAt(o.getDay()),siteList:[],isRequest:!1})}return t}}};e.default=f}).call(this,i(2)["default"])},207:function(t,e,i){"use strict";i.r(e);var n=i(208),r=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=r.a},208:function(t,e,i){}},[[201,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/reservationDetail/reservationDetail.js.map