(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/orderDetail/orderDetail"],{209:function(e,t,n){"use strict";(function(e,t){var o=n(4);n(26);o(n(25));var r=o(n(210));e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n(1)["default"],n(2)["createPage"])},210:function(e,t,n){"use strict";n.r(t);var o=n(211),r=n(213);for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n(216);var i,s=n(32),u=Object(s["default"])(r["default"],o["render"],o["staticRenderFns"],!1,null,"c547daf4",null,!1,o["components"],i);u.options.__file="pages/orderDetail/orderDetail.vue",t["default"]=u.exports},211:function(e,t,n){"use strict";n.r(t);var o=n(212);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},212:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return r})),n.d(t,"staticRenderFns",(function(){return i})),n.d(t,"recyclableRender",(function(){return a})),n.d(t,"components",(function(){return o}));try{o={uNavbar:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-navbar/u-navbar")]).then(n.bind(null,357))},uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,330))},uModal:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-modal/u-modal")]).then(n.bind(null,365))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.sessionList.length);e.$mp.data=Object.assign({},{$root:{g0:n}})},a=!1,i=[];r._withStripped=!0},213:function(e,t,n){"use strict";n.r(t);var o=n(214),r=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=r.a},214:function(e,t,n){"use strict";(function(e){var o=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(56)),a=o(n(58)),i=n(170),s=n(171),u=o(n(215)),c=function(){Promise.all([n.e("common/vendor"),n.e("components/paymentMethod")]).then(function(){return resolve(n(373))}.bind(null,n)).catch(n.oe)},d={components:{PaymentMethod:c},mixins:[u.default],data:function(){return{app:null,order_no:"",detailType:"",gymnasiumInfo:{name:"",phone:"",location:"",latitude:"",longitude:""},show:!1,sessionList:[],orderTime:"",payTime:"",totalPrice:0,payState:"",code:"",scrollViewHeight:0,con:{date:"",timeRange:""},type:"",person:"",phone:"",remark:"",emptyTime:"15:00",timer:null,backType:"",showPop:!1}},onShow:function(){return(0,a.default)(r.default.mark((function e(){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},onLoad:function(e){var t=this;this.app=getApp(),this.order_no=e.order_no,this.type=e.type?e.type:"",this.detailType=e.type,this.$nextTick((function(){t.getNavBarHeight()})),this.initData()},onUnload:function(){if(this.timer&&(clearInterval(this.timer),this.timer=null),this.type&&!this.backType){var t=getCurrentPages();t&&t.length>1?e.navigateBack({delta:1}):history.back()}this.backType=""},methods:{toBack:function(){this.backType="custom",this.app.toBack(this.type?2:1)},initData:function(){var e=this;return(0,a.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.app.getEnum();case 2:n=t.sent,(0,i.request)({url:"wx/get/order/detail",method:"POST",data:{order_no:e.order_no}}).then((function(t){var o=t.data,r=o.site_detail?o.site_detail:[],a=[];r.forEach((function(e){var t=[];e.time_enum.forEach((function(e){t.push({date:o.reserve_date,timeRange:n[e]})})),a.push({hour:e.time_enum.length,price:e.money,siteName:e.site_name,timeList:t})})),e.gymnasiumInfo.name=o.shop_name,e.gymnasiumInfo.phone=o.shop_phone,e.gymnasiumInfo.location=o.shop_address,e.gymnasiumInfo.latitude=o.latitude,e.gymnasiumInfo.longitude=o.longitude,e.orderTime=o.gmt_creat_order,e.payTime=o.gmt_pay,e.totalPrice=o.money/100,e.payState=o.status,e.sessionList=a,e.person=o.user_name,e.phone=o.user_phone,e.remark=o.remark,"N"==o.status?e.setPayTimer(o.gmt_creat_order):(clearInterval(e.timer),e.timer=null,e.emptyTime="15:00")}));case 4:case"end":return t.stop()}}),t)})))()},setPayTimer:function(e){var t=this;this.calateTimeDiff(e),this.timer=setInterval((function(){t.calateTimeDiff(e)}),500)},calateTimeDiff:function(e){var t=new Date(e).getTime(),n=Date.now(),o=Math.floor((n-t)/1e3);if(o<=900){var r=(0,s.formatNumber)(Math.floor((900-o)/60)),a=(0,s.formatNumber)((900-o)%60);this.emptyTime="".concat(r,":").concat(a)}else if(clearInterval(this.timer),this.timer=null,this.payState="C",this.emptyTime="15:00",!this.type){var i=this.getOpenerEventChannel();i.emit("toChangeOrderState",this.order_no,"C")}},getNavBarHeight:function(){var t=e.getSystemInfoSync(),n=t.windowHeight;this.scrollViewHeight=n-122-t.statusBarHeight},toCall:function(){e.makePhoneCall({phoneNumber:this.gymnasiumInfo.phone})},toMap:function(){e.openLocation({latitude:this.gymnasiumInfo.latitude,longitude:this.gymnasiumInfo.longitude,scale:18,name:this.gymnasiumInfo.location})},tocopy:function(){e.setClipboardData({data:this.order_no})},cancel:function(){this.show=!1},getOrderState:function(e){return new Promise((function(t,n){(0,i.request)({url:"wx/get/order/status",method:"POST",data:{order_no:e}}).then((function(e){t(e.data)}))}))},confirm:function(){var t=this;(0,i.request)({url:"wx/cancel/order",method:"POST",data:{order_no:this.order_no}}).then((function(){t.payState="C",e.showToast({title:"取消成功",icon:"none",duration:2e3,success:function(){if(t.show=!1,!t.type){var e=t.getOpenerEventChannel();e.emit("toChangeOrderState",t.order_no,"C")}setTimeout((function(){t.initData()}),2e3)}})}))},cancelOrder:function(){this.show=!0},payComplete:function(t){var n=this;e.showToast({title:"success"==t?"支付成功":"支付取消",icon:"none",duration:2e3,success:function(){if("success"==t&&!n.type){var e=n.getOpenerEventChannel();e.emit("toChangeOrderState",n.order_no,"Y")}setTimeout((function(){n.initData()}),2e3)}})},toPay:function(){this.showPop=!0},confirmPay:function(){var e=this,t="web";(0,i.request)({url:"wx/pay",method:"POST",data:{order_no:this.order_no,type:t}}).then((function(t){e.wxPay(t.data.per_pay,e.payComplete)}))},cancelPay:function(){this.showPop=!1,this.payMoney=0},toEnsurePay:function(t){var n=this;return(0,a.default)(r.default.mark((function o(){return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(0!=t){o.next=9;break}return n.showPop=!1,o.next=4,n.balancePayment();case 4:o.sent,e.showToast({title:"支付成功",icon:"none",duration:2e3,success:function(){if(!n.type){var e=n.getOpenerEventChannel();e.emit("toChangeOrderState",n.order_no,"Y")}setTimeout((function(){n.initData()}),2e3)}}),o.next=11;break;case 9:n.showPop=!1,n.confirmPay();case 11:case"end":return o.stop()}}),o)})))()},balancePayment:function(){var e=this;return(0,a.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.app.getUserInfo();case 2:return n=t.sent,t.abrupt("return",new Promise((function(t,o){(0,i.request)({url:"wx/balance/pay",method:"POST",data:{order_no:e.order_no,user_ouid:n.ouid}}).then((function(e){200==e.code&&t(!0)}))})));case 4:case"end":return t.stop()}}),t)})))()},toUse:function(){e.navigateTo({url:"/pages/reservationInfo/reservationInfo?order_no="+this.order_no})}}};t.default=d}).call(this,n(2)["default"])},216:function(e,t,n){"use strict";n.r(t);var o=n(217),r=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=r.a},217:function(e,t,n){}},[[209,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/orderDetail/orderDetail.js.map