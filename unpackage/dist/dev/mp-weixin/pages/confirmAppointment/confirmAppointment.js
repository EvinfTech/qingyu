(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/confirmAppointment/confirmAppointment"],{290:function(e,n,t){"use strict";(function(e,n){var o=t(4);t(26);o(t(25));var r=o(t(291));e.__webpack_require_UNI_MP_PLUGIN__=t,n(r.default)}).call(this,t(1)["default"],t(2)["createPage"])},291:function(e,n,t){"use strict";t.r(n);var o=t(292),r=t(294);for(var a in r)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(a);t(296);var i,s=t(32),u=Object(s["default"])(r["default"],o["render"],o["staticRenderFns"],!1,null,"f2065834",null,!1,o["components"],i);u.options.__file="pages/confirmAppointment/confirmAppointment.vue",n["default"]=u.exports},292:function(e,n,t){"use strict";t.r(n);var o=t(293);t.d(n,"render",(function(){return o["render"]})),t.d(n,"staticRenderFns",(function(){return o["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return o["recyclableRender"]})),t.d(n,"components",(function(){return o["components"]}))},293:function(e,n,t){"use strict";var o;t.r(n),t.d(n,"render",(function(){return r})),t.d(n,"staticRenderFns",(function(){return i})),t.d(n,"recyclableRender",(function(){return a})),t.d(n,"components",(function(){return o}));try{o={uNavbar:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-navbar/u-navbar")]).then(t.bind(null,357))},uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,330))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,n=e.$createElement,t=(e._self._c,e.sessionList.length);e.$mp.data=Object.assign({},{$root:{g0:t}})},a=!1,i=[];r._withStripped=!0},294:function(e,n,t){"use strict";t.r(n);var o=t(295),r=t.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);n["default"]=r.a},295:function(e,n,t){"use strict";(function(e){var o=t(4);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(t(56)),a=o(t(58)),i=t(170),s=o(t(215)),u=function(){Promise.all([t.e("common/vendor"),t.e("components/paymentMethod")]).then(function(){return resolve(t(373))}.bind(null,t)).catch(t.oe)},c={mixins:[s.default],components:{PaymentMethod:u},data:function(){return{app:null,centerHeight:0,orderInfo:{},gymnasiumInfo:{},userName:"",phone:"",remark:"",userInfo:{},sessionList:[],show:!1,order_no:"",showPop:!1,payMoney:0}},onLoad:function(){var n=this;return(0,a.default)(r.default.mark((function t(){var o,a,i,s;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n.app=getApp(),o=e.getStorageSync("orderInfo"),o=JSON.parse(o),n.orderInfo=o,t.next=6,n.app.getStoreInfo();case 6:return n.gymnasiumInfo=t.sent,t.next=9,n.app.getUserInfo();case 9:return n.userInfo=t.sent,t.next=12,n.app.getEnum();case 12:a=t.sent,n.userName=n.userInfo.name,n.phone=n.userInfo.phone,i=[],s=o.site_detail,s.forEach((function(e){var n=[];e.time_enum.forEach((function(e){n.push({date:o.gmt_site_use,timeRange:a[e]})})),i.push({hour:e.time_enum.length,price:e.money,siteName:e.site_name,timeList:n})})),n.sessionList=i;case 19:case"end":return t.stop()}}),t)})))()},onReady:function(){var e=this;this.$nextTick((function(){e.calculate()}))},onShow:function(){},methods:{toBackPage:function(){this.app.toBack()},calculate:function(){var n=e.getSystemInfoSync(),t=n.windowHeight;this.centerHeight=t-122-n.statusBarHeight},createOrder:function(){var n=this;(0,i.request)({url:"wx/add/order",method:"POST",data:{user_ouid:this.userInfo.ouid,site_detail:this.orderInfo.site_detail,gmt_site_use:this.orderInfo.gmt_site_use,reserve_name:this.userName,reserve_phone:this.phone,remark:this.remark}}).then((function(t){"操作成功"==t.msg?(n.order_no=t.data.order,n.payMoney=t.data.money/100,n.showPop=!0):(e.showToast({title:t.msg+",请重选",icon:"none"}),setTimeout((function(){var e=n.getOpenerEventChannel();e.emit("updateSiteInfo",t.data.site),setTimeout((function(){n.app.toBack()}),200)}),1500))}))},cancelPay:function(){this.showPop=!1,this.payMoney=0,e.removeStorageSync("orderInfo"),e.redirectTo({url:"/pages/orderDetail/orderDetail?order_no="+this.order_no+"&type=new"})},toEnsurePay:function(n){var t=this;return(0,a.default)(r.default.mark((function o(){var a;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(0!=n){o.next=7;break}return o.next=3,t.balancePayment();case 3:a=o.sent,a&&(t.showPop=!1,e.showToast({title:"支付成功",icon:"none",duration:2e3,success:function(){t.payMoney=0,setTimeout((function(){e.removeStorageSync("orderInfo"),e.redirectTo({url:"/pages/orderDetail/orderDetail?order_no="+t.order_no+"&type=new"})}),200)}})),o.next=9;break;case 7:t.showPop=!1,t.confirm();case 9:case"end":return o.stop()}}),o)})))()},balancePayment:function(){var e=this;return new Promise((function(n,t){(0,i.request)({url:"wx/balance/pay",method:"POST",data:{order_no:e.order_no,user_ouid:e.userInfo.ouid}}).then((function(e){200==e.code&&n(!0)}))}))},confirm:function(){var e=this,n="web";(0,i.request)({url:"wx/pay",method:"POST",data:{order_no:this.order_no,type:n}}).then((function(n){e.wxPay(n.data.per_pay,e.payComplete)}))},cancel:function(){this.show=!1,e.removeStorageSync("orderInfo"),e.redirectTo({url:"/pages/orderDetail/orderDetail?order_no="+this.order_no+"&type=new"})},payComplete:function(n){var t=this;e.showToast({title:"success"==n?"支付成功":"支付取消",icon:"none",duration:2e3,success:function(){setTimeout((function(){e.removeStorageSync("orderInfo"),e.redirectTo({url:"/pages/orderDetail/orderDetail?order_no="+t.order_no+"&type=new"})}),200)}})}}};n.default=c}).call(this,t(2)["default"])},296:function(e,n,t){"use strict";t.r(n);var o=t(297),r=t.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);n["default"]=r.a},297:function(e,n,t){}},[[290,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/confirmAppointment/confirmAppointment.js.map